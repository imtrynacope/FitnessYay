<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FitnessYay - Checkout</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="cart.css">
</head>

<body>
  <!-- Navigation -->
  <nav>
    <div class="nav-container">
      <a href="index.html" class="logo">
        <i class="fas fa-heartbeat"></i> FitnessYay
      </a>
      
      <div class="nav-links">
        <a href="index.html">Home</a>
        <a href="product.html">Products</a>
        <a href="announcements.html">Announcements</a>
        <a href="store-locator.html">Store Locator</a>
        <a href="feedback.html">Feedback</a>
        <a href="blog.html">Blog</a>
        <a href="aboutus.html">About Us</a>
        <a href="community.html">Community</a>
      </div>
      
      <div class="nav-actions">
        <a href="wishlist.html"><i class="fas fa-heart"></i></a>
        <a href="cart.html"><i class="fas fa-shopping-cart"></i></a>
        <a href="login.html" class="cta">Login</a>
      </div>
    </div>
  </nav>

  <div class="container">
    <div class="page-header">
      <h1 class="page-title">Checkout</h1>
      <p class="page-subtitle">Finalize your purchase and get ready to start your fitness journey</p>
    </div>

    <div id="checkoutContent">
      <!-- Content will be populated by JavaScript -->
    </div>
  </div>

  <!-- Payment Modal -->
  <div class="payment-modal" id="paymentModal">
    <div class="payment-content">
      <span class="modal-close" id="modalClose">&times;</span>
      <h2>Payment Details</h2>
      <form id="paymentForm" class="payment-form">
        <div class="form-group">
          <label for="cardNumber">Card Number</label>
          <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" required>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="expiryDate">Expiry Date</label>
            <input type="text" id="expiryDate" placeholder="MM/YY" required>
          </div>

          <div class="form-group">
            <label for="cvv">CVV</label>
            <input type="text" id="cvv" placeholder="123" required>
          </div>
        </div>

        <div class="form-group">
          <label for="cardholderName">Cardholder Name</label>
          <input type="text" id="cardholderName" placeholder="John Doe" required>
        </div>

        <button type="submit" class="pay-btn" id="payBtn">Pay Now</button>
      </form>
    </div>
  </div>

  <div class="notification" id="notification"></div>

  <!-- Footer -->
  <footer>
    <div class="footer-container">
      <div class="footer-col">
        <h3>FitnessYay</h3>
        <p>Advanced fitness technology designed to help you understand your body and optimize your performance.</p>
        <div class="social-links">
          <a href="https://www.facebook.com/share/165jhQH88w/" target="_blank"><i class="fab fa-facebook-f"></i></a>
          <a href="https://x.com/wei_koong?s=11&t=D4hR4elKriVny7R_YYT4Fw" target="_blank"><i class="fab fa-twitter"></i></a>
          <a href="https://www.instagram.com/phebbeee?igsh=MXVpM2MyNXp1dTdtcQ%3D%3D&utm_source=qr" target="_blank"><i class="fab fa-instagram"></i></a>
          <a href="https://www.linkedin.com/in/YourProfile" target="_blank"><i class="fab fa-linkedin-in"></i></a>
          <a href="https://www.youtube.com/channel/YourChannel" target="_blank"><i class="fab fa-youtube"></i></a>
        </div>
      </div>

      <div class="footer-col">
        <h3>Products</h3>
        <ul>
          <li><a href="product.html">Smartwatches</a></li>
          <li><a href="product.html">Smart Scales</a></li>
          <li><a href="product.html">Wireless Earbuds</a></li>
          <li><a href="product.html">Accessories</a></li>
          <li><a href="app.html">Mobile App</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h3>Company</h3>
        <ul>
          <li><a href="aboutus.html">About Us</a></li>
          <li><a href="blog.html">Blog</a></li>
          <li><a href="careers.html">Careers</a></li>
          <li><a href="press.html">Press</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h3>Support</h3>
        <ul>
          <li><a href="help.html">Help Center</a></li>
          <li><a href="community.html">Community</a></li>
          <li><a href="warranty.html">Warranty</a></li>
          <li><a href="returns.html">Returns & Refunds</a></li>
          <li><a href="shipping.html">Shipping Information</a></li>
        </ul>
      </div>
    </div>

    <div class="copyright">
      <p>&copy; 2025 FitnessYay. All rights reserved.</p>
    </div>
  </footer>

  <script>
    // login helpers
    document.addEventListener('DOMContentLoaded', function () {
      const loginBtn = document.querySelector('.nav-actions .cta');

      if (isLoggedIn()) {
        loginBtn.textContent = 'Logout';
        loginBtn.href = '#'; // Prevent going to login page
        loginBtn.addEventListener('click', function (e) {
          e.preventDefault();
          if (confirm('Are you sure you want to log out?')) {
            sessionStorage.removeItem('fitnessYayLoggedIn');
            alert('You have been logged out.');
            window.location.href = 'index.html'; // redirect after logout
          }
        });
      } else {
        loginBtn.textContent = 'Login';
        loginBtn.href = 'login.html';
      }
    });

    // constants & product list
    const FREE_SHIPPING_THRESHOLD = 1499;
    const ALL_PRODUCTS = [
      { id: 1, name: 'FitnessYay Ultra Charge 5', price: 1179.95, image: 'fitnessyay1.png' },
      { id: 2, name: 'FitnessYay Series 7', price: 1399.00, image: 'fitnessyay2.png' },
      { id: 3, name: 'FitnessYay Series 6', price: 1399.99, image: 'fitnessyay3.png' },
      { id: 4, name: 'FitnessYay Ultra Charge 4', price: 1344.99, image: 'fitnessyay4.png' },
      { id: 5, name: 'Wireless Sport Earbuds', price: 349.00, image: 'https://cdn.pixabay.com/photo/2023/09/21/09/59/man-8266387_1280.jpg' },
      { id: 6, name: 'Bluetooth Smart Scale', price: 599.00, image: 'https://images.ctfassets.net/4f3rgqwzdznj/6qevHGenCa1f7oNGoU5rmy/55bb3b64b8446676462c3f0853f63fe6/GettyImages-649745984_BW.jpg' }
    ];

    // session storage cart helpers
    function getCart() {
      const stored = sessionStorage.getItem('fitnessYayCart');
      return stored ? JSON.parse(stored) : [];
    }

    function saveCart(cart) {
      sessionStorage.setItem('fitnessYayCart', JSON.stringify(cart));
      renderCheckout();
    }

    // notification helper
    function showNotification(message) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.classList.add('show');
      setTimeout(() => notification.classList.remove('show'), 3000);
    }

    // login helpers
    function isLoggedIn() {
      return sessionStorage.getItem('fitnessYayLoggedIn') === 'true';
    }

    function requireLoginThen(fn) {
      if (!isLoggedIn()) {
        if (confirm('You must sign in to proceed to checkout. Go to login page?')) {
          window.location.href = 'login.html';
        }
        return;
      }
      fn();
    }

    // renderCheckout
    function renderCheckout() {
      const cartItems = getCart();
      const checkoutContent = document.getElementById('checkoutContent');

      if (cartItems.length === 0) {
        checkoutContent.innerHTML = `
          <div class="empty-cart">
            <div class="empty-icon">
              <i class="fas fa-shopping-cart"></i>
            </div>
            <h2 class="empty-title">Your cart is empty</h2>
            <p class="empty-description">
              Looks like you haven't added anything to your cart yet. Browse our products and find something you love!
            </p>
            <a href="product.html" class="browse-btn">Browse Products</a>
          </div>
        `;
        return;
      }

      const subtotal = cartItems.reduce((sum, item) => sum + item.price * item.quantity, 0);
      const shippingFee = subtotal >= FREE_SHIPPING_THRESHOLD ? 0 : 20;
      const total = subtotal + shippingFee;

      const shippingMessageClass = subtotal >= FREE_SHIPPING_THRESHOLD ? 'free' : 'paid';
      const shippingMessageText = subtotal >= FREE_SHIPPING_THRESHOLD ?
        'You got FREE SHIPPING!' :
        `Spend RM${(FREE_SHIPPING_THRESHOLD - subtotal).toFixed(2)} more to get free shipping`;

      const cartItemsHTML = cartItems.map(item => `
        <div class="cart-item" data-id="${item.id}">
          <div class="item-image">
            <img src="${item.image}" alt="${item.name}">
          </div>
          <div class="item-info">
            <h3 class="item-name">${item.name}</h3>
            <div class="item-price">RM${(item.price * item.quantity).toFixed(2)}</div>
          </div>
          <div class="quantity-controls">
            <button onclick="updateQuantity(${item.id}, -1)">-</button>
            <span>${item.quantity}</span>
            <button onclick="updateQuantity(${item.id}, 1)">+</button>
          </div>
          <button class="remove-btn" onclick="removeFromCart(${item.id})">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      `).join('');

      const suggestedItemsHTML = getSuggestedItems(cartItems).map(item => `
        <div class="suggested-item" data-id="${item.id}">
          <img src="${item.image}" alt="${item.name}">
          <h3>${item.name}</h3>
          <p>RM${item.price.toFixed(2)}</p>
          <button class="add-to-cart-btn" onclick="addToCartFromSuggestion(${item.id})">Add to Cart</button>
        </div>
      `).join('');

      checkoutContent.innerHTML = `
        <div class="checkout-content">
          <div class="main-content">
            <div class="cart-summary">
              <h2 class="summary-heading">Your Order</h2>
              <div id="cartItemsList">${cartItemsHTML}</div>
            </div>
            <div class="suggestions">
              <h2>You Might Also Like</h2>
              <div class="suggestions-grid">
                ${suggestedItemsHTML}
              </div>
            </div>
          </div>
          <div class="order-summary">
            <h2 class="summary-heading">Order Summary</h2>
            <div class="summary-item">
              <span class="label">Subtotal</span>
              <span class="value">RM${subtotal.toFixed(2)}</span>
            </div>
            <div class="summary-item">
              <span class="label">Shipping</span>
              <span class="value">RM${shippingFee.toFixed(2)}</span>
            </div>
            <div class="shipping-message-box ${shippingMessageClass}">
              <i class="fas fa-info-circle"></i> ${shippingMessageText}
            </div>
            <div class="summary-total">
              <span>Total</span>
              <span>RM${total.toFixed(2)}</span>
            </div>
            <button class="checkout-btn" id="proceedPaymentBtn">Proceed to Payment</button>
          </div>
        </div>
      `;

      // wire up proceed button
      document.getElementById('proceedPaymentBtn').addEventListener('click', function () {
        requireLoginThen(showPaymentModal);
      });
    }

    function updateQuantity(itemId, change) {
      const cart = getCart();
      const itemToUpdate = cart.find(item => item.id === itemId);

      if (itemToUpdate) {
        itemToUpdate.quantity += change;
        if (itemToUpdate.quantity <= 0) {
          removeFromCart(itemId);
        } else {
          saveCart(cart);
        }
      }
    }

    function removeFromCart(itemId) {
      const cart = getCart();
      const updatedCart = cart.filter(item => item.id !== itemId);
      saveCart(updatedCart);
      showNotification('Item removed from cart!');
    }

    function addToCartFromSuggestion(itemId) {
      requireLoginThen(() => {
        const cart = getCart();
        const suggestedItem = ALL_PRODUCTS.find(item => item.id === itemId);
        if (!suggestedItem) return;
        const existingItem = cart.find(item => item.id === suggestedItem.id);
        if (existingItem) existingItem.quantity++;
        else cart.push({ id: suggestedItem.id, name: suggestedItem.name, price: suggestedItem.price, quantity: 1, image: suggestedItem.image });
        saveCart(cart);
        showNotification(`${suggestedItem.name} added to cart!`);
      });
    }

    function getSuggestedItems(cart) {
      const cartItemIds = new Set(cart.map(item => item.id));
      return ALL_PRODUCTS.filter(product => !cartItemIds.has(product.id)).slice(0, 3);
    }

    function showPaymentModal() {
      document.getElementById('paymentModal').style.display = 'flex';
    }

    function hidePaymentModal() {
      document.getElementById('paymentModal').style.display = 'none';
    }

    // Checkout.com Payment API Integration
    function processPayment(paymentData) {
      // This is a simulation - in a real implementation, you would use the Checkout.com API
      // with proper authentication and security measures

      const cart = getCart();
      const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
      const shippingFee = subtotal >= FREE_SHIPPING_THRESHOLD ? 0 : 20;
      const total = subtotal + shippingFee;

      // Simulate API call to Checkout.com
      $('#payBtn').addClass('loading').text('Processing...');

      // This would be the actual API call in a real implementation:
      /*
      $.ajax({
        url: 'https://api.checkout.com/payments',
        type: 'POST',
        headers: {
          'Authorization': 'Bearer YOUR_SECRET_KEY',
          'Content-Type': 'application/json'
        },
        data: JSON.stringify({
          source: {
            type: 'card',
            number: paymentData.cardNumber,
            expiry_month: paymentData.expiryMonth,
            expiry_year: paymentData.expiryYear,
            cvv: paymentData.cvv,
            name: paymentData.cardholderName
          },
          amount: Math.round(total * 100), // Amount in cents
          currency: 'MYR',
          reference: 'FitnessYay-' + Date.now(),
          description: 'FitnessYay Purchase'
        }),
        success: function(response) {
          if (response.approved) {
            showNotification('Payment successful! Thank you for your order.');
            saveCart([]); // Clear cart after successful checkout
            hidePaymentModal();
          } else {
            showNotification('Payment failed: ' + response.response_summary);
            $('#payBtn').removeClass('loading').text('Pay Now');
          }
        },
        error: function(xhr, status, error) {
          showNotification('Payment error: ' + error);
          $('#payBtn').removeClass('loading').text('Pay Now');
        }
      });
      */

      // Simulate API response after 2 seconds
      setTimeout(() => {
        // Simulate successful payment 80% of the time
        const isSuccess = Math.random() > 0.2;

        if (isSuccess) {
          showNotification('Payment successful! Thank you for your order.');
          saveCart([]); // Clear cart after successful checkout
          hidePaymentModal();
        } else {
          showNotification('Payment failed: Please check your card details and try again.');
          $('#payBtn').removeClass('loading').text('Pay Now');
        }
      }, 2000);
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', function () {
      renderCheckout();

      // Payment form submission
      document.getElementById('paymentForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
        const expiryDate = document.getElementById('expiryDate').value.split('/');
        const cvv = document.getElementById('cvv').value;
        const cardholderName = document.getElementById('cardholderName').value;

        // Basic validation
        if (cardNumber.length !== 16 || isNaN(cardNumber)) {
          showNotification('Please enter a valid card number');
          return;
        }

        if (expiryDate.length !== 2 || expiryDate[0].length !== 2 || expiryDate[1].length !== 2) {
          showNotification('Please enter a valid expiry date (MM/YY)');
          return;
        }

        if (cvv.length < 3 || isNaN(cvv)) {
          showNotification('Please enter a valid CVV');
          return;
        }

        if (cardholderName.length < 3) {
          showNotification('Please enter cardholder name');
          return;
        }

        const paymentData = {
          cardNumber: cardNumber,
          expiryMonth: expiryDate[0],
          expiryYear: '20' + expiryDate[1],
          cvv: cvv,
          cardholderName: cardholderName
        };

        processPayment(paymentData);
      });

      // Close modal
      document.getElementById('modalClose').addEventListener('click', hidePaymentModal);

      // Close modal when clicking outside
      document.getElementById('paymentModal').addEventListener('click', function (e) {
        if (e.target === this) hidePaymentModal();
      });
    });
  </script>
</body>


</html>

