<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FitnessYay — Sign Up</title>
  <link rel="stylesheet" href="styles.css">
  <!-- jQuery Library -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
  <main class="wrap" role="main" aria-labelledby="signup-heading">
    <!-- LEFT PANEL -->
    <section class="panel-left" aria-hidden="true">
      <a href="index.html">
        <h1>FitnessYay</h1>
      </a>
      <p><strong>Join FitnessYay and start your fitness journey today.</strong></p>
      <ul class="feature-list">
        <li>Personalized fitness plans</li>
        <li>Nutrition & calorie tracking</li>
        <li>Progress charts & wearable sync</li>
      </ul>
    </section>

    <!-- RIGHT PANEL -->
    <section class="panel-right">
      <div class="form-container">
        <h2 id="signup-heading">Create Your Account</h2>
        <p class="form-sub">Sign up to access tracking, workouts, and more.</p>

        <form class="signup-form" id="signupForm" action="#" method="POST" novalidate>
          <div class="field">
            <label for="fullname">Full name</label>
            <input id="fullname" name="fullname" type="text" placeholder="John Doe" required>
          </div>

          <div class="field">
            <label for="emailSign">Email address</label>
            <input id="emailSign" name="email" type="email" placeholder="you@example.com" required>
          </div>

          <div class="field pw-wrap">
            <label for="passwordSign">Password</label>
            <input id="passwordSign" name="password" type="password" placeholder="••••••••" required minlength="6">
            <button type="button" class="pw-toggle" id="pwToggle1">Show</button>
          </div>

          <div class="field pw-wrap">
            <label for="confirmPassword">Confirm Password</label>
            <input id="confirmPassword" name="confirmPassword" type="password" placeholder="••••••••" required
              minlength="6">
            <button type="button" class="pw-toggle" id="pwToggle2">Show</button>
            <div id="pwError" class="error" style="display:none; color:red; margin-top:5px;"></div>
          </div>

          <button class="btn btn-primary" type="submit" id="submitBtn">Sign In</button>

          <p class="signup-note">Already have an account? <a href="login.html">Log in</a></p>
        </form>

        <nav class="links" aria-label="Footer links">
          <a href="terms.html">Terms</a>
          <a href="privacy.html">Privacy</a>
          <a href="contact.html">Contact</a>
        </nav>

        <div class="small" style="text-align:center; margin-top:8px">© <span id="year"></span> FitnessYay</div>
      </div>
    </section>
  </main>

  <script>
    // Dynamic year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Password toggle buttons
    function togglePw(inputId, btn) {
      const input = document.getElementById(inputId);
      if (input.type === "password") {
        input.type = "text";
        btn.textContent = "Hide";
      } else {
        input.type = "password";
        btn.textContent = "Show";
      }
    }
    document.getElementById("pwToggle1").addEventListener("click", function () {
      togglePw("passwordSign", this);
    });
    document.getElementById("pwToggle2").addEventListener("click", function () {
      togglePw("confirmPassword", this);
    });

    // Cookie helpers (unchanged behavior)
    function setCookie(name, value, days) {
      const d = new Date();
      d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
      const expires = "expires=" + d.toUTCString();
      document.cookie = name + "=" + encodeURIComponent(value) + ";" + expires + ";path=/";
    }

    function getCookie(name) {
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i].trim();
        if (c.indexOf(nameEQ) === 0) return decodeURIComponent(c.substring(nameEQ.length));
      }
      return null;
    }

    function getUserCount() {
      const count = parseInt(getCookie('user_count'));
      return isNaN(count) ? 0 : count;
    }

    function setUserCount(n) {
      setCookie('user_count', n, 30);
    }

    function getUserByIndex(i) {
      const raw = getCookie('user_' + i);
      if (!raw) return null;
      try {
        return JSON.parse(raw);
      } catch (e) {
        return null;
      }
    }

    function findUserByEmail(email) {
      const count = getUserCount();
      for (let i = 1; i <= count; i++) {
        const user = getUserByIndex(i);
        if (user && user.email && user.email.toLowerCase() === email.toLowerCase()) {
          return { index: i, user: user };
        }
      }
      return null;
    }

    // Save a separate cookie per user (user_1, user_2, ...)
    function saveNewUser(userObj) {
      // Prevent duplicate email
      const existing = findUserByEmail(userObj.email);
      if (existing) {
        return { ok: false, message: 'An account with this email already exists.' };
      }

      let count = getUserCount();
      count = count + 1;
      setCookie('user_' + count, JSON.stringify(userObj), 30);
      setUserCount(count);
      return { ok: true, index: count };
    }

    $(function () {
      $("#signupForm").submit(function (event) {
        event.preventDefault();

        var name = $("#fullname").val().trim();
        var email = $("#emailSign").val().trim();
        var pass1 = $("#passwordSign").val();
        var pass2 = $("#confirmPassword").val();

        var pwError = $("#pwError");
        pwError.hide().text("");

        if (!name || !email || !pass1 || !pass2) {
          pwError.show().text("Please fill out all required fields.");
          return;
        }
        if (pass1.length < 6) {
          pwError.show().text("Password must be at least 6 characters.");
          return;
        }
        if (pass1 !== pass2) {
          pwError.show().text("Passwords do not match.");
          return;
        }

        const userObj = {
          fullname: name,
          email: email,
          password: pass1
        };

        const res = saveNewUser(userObj);
        if (!res.ok) {
          pwError.show().text(res.message);
          return;
        }

        alert("Signup successful! You can now log in.");
        // optionally set last_logged_email for convenience
        setCookie('last_login_email', email, 30);
        window.location.href = "login.html";
      });
    });
  </script>

</html>